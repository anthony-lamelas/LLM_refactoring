```c
// Refactored code with clear comments
#include <stdio.h>
#include <unistd.h>

// Constants for the program
#define MIN_PRINTABLE_CHAR 33
#define MAX_PRINTABLE_CHAR 127
#define WIDTH 9999
#define HEIGHT 9999

// Global variables
int N, M, S, T, W, X;
char A[WIDTH][HEIGHT] = {0};
char B[WIDTH][HEIGHT];

// Function prototypes
void initialize_array(int c);
void process_array(int t, int d);
void clear_screen();

// Initialize array A with spaces where value is 0
void initialize_array(int c) {
    int i = M * N;
    for (; i--; ) {
        A[i % N][i / N] = (!c ? 32 : A[i % N][i / N]);
    }
}

// Process the array with given transformation logic
void process_array(int t, int d) {
    for (int i, j, k = ~d / 2 * 3 + 3, l; j = k != 2, k - (3 + 5 * d) / 2; k += d) {
        long long m = M * N, n = j ? M : N, u = (2 * k - k / 2 * 3 - k / 3 * 5) * d, x, y, w, s;
        for (i = m; i--; ) B[i % N][i / N] = A[i % N][i / N];
        for (i = n; i--; ) {
            s = S + k;
            for (w = 0, l = 6; l -= 2; ) {
                s = (s + T) * W % X;
                x = l * i + s % W * n * t / W / 5 + n * (n + s % W) - n * t / 10;
                w += x % n * (n - x % n) * (x / n % 2 * 2 - 1) * (3 + k % 3 + k / 2);
            }
            w = (w + n * n / (w > 0 ? 2 : -2)) / n / n;
            for (l = j ? N : M; l--; x = j * i + u * l + m * 4, y = !j * i + d * j * l + m * 4) {
                A[y % N][x % M] = B[(y + d * j * w) % N][(x + u * w) % M];
            }
        }
    }
}

// Clear the screen and reset cursor position
void clear_screen() {
    fprintf(stderr, "\033[H");
    fflush(stderr);
}

int main(int argc, char **argv) {
    char *s;
    int x = 0, y = 0, n[256] = {0}, a, b, c;
    W = 33331;
    X = 33333331;
    N = 40;
    S = T = 0;

    if (++argc && sscanf(*++argv, "%ld", &N)) {
        --argc;
        argv++;
    }

    if (argc > 1) {
        for (s = *argv++; *s; ) {
            T = (T * W + *s++) % X;
        }
    }

    while ((c = getchar()) >= 0) {
        n[c]++;
        c != 10 ? A[y][x++] = c : (y++, x = 0);
    }

    M = 2 * N;
    initialize_array(0);

    for (int i = MIN_PRINTABLE_CHAR; i < MAX_PRINTABLE_CHAR; i++) {
        S = (3331 * S + n[i]) % W;
    }

    for (int i = c = 0; i < 128; i++) {
        x = -(6 >> i / 32) % 2 * 2 + 1;
        process_array((96 + i * x + ~-x / 2) % 32, x);
        for (int j = a = 0; i % 64 == 31 && j < N * M; b = A[j / M][j % M] & 95, c += x * (a | !b && (j % M)), a = b, j++);
    }

    for (x = 0; x <= 32; x++) {
        int j = WIDTH;
        while (j--) {
            s = A[j];
            while (*s) s++;
            while (*--s == 32) *s = 0;
        }

        for (j = x / 32, a = ~-WIDTH; ~j; j--) {
            for (; a && !*A[a];) a--;
            clear_screen();
            for (int i = 0; j ? i <= a : i < y || i < N; i++) {
                !j ? fprintf(stderr, "%s\033[K\n", A[i]) : puts(A[i]);
            }
        }

        initialize_array(0);
        if (x - 32) c < 0 ? process_array(31 - x, -1) : process_array(x, 1);
        usleep(W << 1);
    }

    return 0;
}
```