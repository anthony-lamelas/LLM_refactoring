```c
// Refactored code with clear comments
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>

// Function declarations
long random_in_range(long min, long max);
long calculate_offset(long x);
void print_message(long index);
long determine_condition();
void handle_hell_exit();
void handle_heaven_exit();
void switch_case_logic(long input);
void process_user_input();

// Global variables
unsigned int m, D, Q, v, l, Y, f, g, X, z, B, i, h, C = 21, r, u, d, e;
long party_resources[7], temp_values[7], quest_modifier = 666, health = 666, max_capacity, current_capacity;
char *data_buffer, *message_buffer;
FILE *data_file;
size_t buffer_size;

// Constants
#define DATA_FILE "data.txt" // Example data file name

// Function to generate a random number within a given range
long random_in_range(long min, long max) {
    return rand() % (max - min + 1) + min;
}

// Function to calculate offset for message retrieval
long calculate_offset(long x) {
    return x * 1663;
}

// Function to print a message based on the index
void print_message(long index) {
    printf("%s", &data_buffer[calculate_offset(index)]);
}

// Function to determine a condition based on current state
long determine_condition() {
    return party_resources[2] > 0 ? random_in_range(0, 99) > 49 : 0;
}

// Main function
int main(int argc, char **argv) {
    // Seed random number generator
    srand(time(NULL));

    // Parse command-line arguments
    quest_modifier = argc > 2 ? strtol(argv[2], NULL, 0) : quest_modifier;
    C = argv[1] ? strtoul(argv[1], NULL, 0) : C;

    // Open data file
    data_file = fopen(DATA_FILE, "r");
    if (!data_file || getdelim(&data_buffer, &buffer_size, EOF, data_file) < 0) {
        handle_hell_exit();
    }

    // Main game loop
    while (1) {
        process_user_input();
        // Additional game logic here
    }

    // Clean up and exit
    fclose(data_file);
    return 0;
}

// Function to handle exit to "hell"
void handle_hell_exit() {
    exit(666);
}

// Function to handle exit to "heaven"
void handle_heaven_exit() {
    // Logic for "heaven" exit
}

// Function to process user input and game state
void process_user_input() {
    // Logic to process user input and update game state
    if (z) {
        print_message(1);
        // Further input handling
    } else {
        print_message(42);
        // Further input handling
    }
}

// Function to handle switch-case logic
void switch_case_logic(long input) {
    switch (input) {
        case 1:
            // Case 1 logic
            break;
        case 2:
            // Case 2 logic
            break;
        // Additional cases
        default:
            // Default case logic
            break;
    }
}
```

**Note:** This refactoring assumes certain interpretations of the original code's intent and attempts to improve readability and structure while maintaining the original functionality. The data file name "data.txt" is used as a placeholder for the `DATA` macro.