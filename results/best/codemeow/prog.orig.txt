#include <stdio.h>
#include <stdlib.h>
#include <sys/ioctl.h>
#include <sys/time.h>
#include <unistd.h>

// External declarations
extern long write();
extern double O[];
extern int nanosleep();
extern int gettimeofday();

// Global variables
int a, b, c, d, v, E = 0;

// Function to write data to file descriptor
void w(char* data, long length) {
    write(1, data, length);
}

// Function to generate a random byte
unsigned char r() {
    v ^= 8;
    return ++v % 8;
}

// Function to obtain a random byte from a specific index of O
int L(int index) {
    return ((char*)&O[index])[r()];
}

// Function to write a specific part of O
void P(int index) {
    w(((char*)(O + 14)) + index * 2, 2);
}

// Function to write another specific part of O
void S(int index) {
    w(((char*)(O + 16)) + index * 3, 3);
}

// Function to calculate a character based on an index and offset
int Q(int value, int offset) {
    return value / (*((char*)(O + 18) + offset)) % 10 + 48;
}

// Function to update a random seed
void u() {
    char buffer[16];
    gettimeofday((struct timeval*) buffer, 0L);
    v = buffer[0];
}

// Function to get terminal window size
void g() {
    unsigned long size;
    ioctl(1, TIOCGWINSZ, &size);
    b = size & 65535;
    a = size >> 16 & 65535;
    c = a / 2 - 12;
    d = b - 4;
}

// Function to write ANSI escape sequences
void e() {
    w("\033[", 2);
}

// Functions to set and reset text attributes
void i() {
    e();
    w("1m", 2);
}

void j() {
    e();
    w("0m", 2);
}

// Function to switch to the alternate screen
void k() {
    e();
    w("?1049h", 6);
    e();
    w("2J", 2);
    e();
    w("H", 1);
}

// Function to position the cursor
void l(int row, int col) {
    e();
    w((char[]){Q(row, 2), Q(row, 1), Q(row, 0)}, 3);
    w(";", 1);
    w((char[]){Q(col, 2), Q(col, 1), Q(col, 0)}, 3);
    w("H", 1);
}

// Function to set text color
void m(int color) {
    e();
    P(color);
    w("m", 1);
}

// Function to display data
void n() {
    for (int i = 0; i < 18; i++) {
        l(d + i / 6, c + (i % 6) * 4);
        m(((char*)&O)[E++]);
        w(((char*)&O) + (i << 2) + 24, 4);
    }
}

// Function to create a delay
void o() {
    char buffer[16] = {0};
    buffer[11] = 1;
    nanosleep((const struct timespec*) buffer, 0L);
}

// Function to set terminal attributes based on a condition
void q(int cond) {
    if (cond < 3) cond = 2;
    int x[] = {3, 0, 1, 2, 0, 1};
    if (r() < 2) {
        i();
        m(x[cond - 2]);
    } else {
        m(x[cond + 1]);
    }
}

// Function to determine movement based on conditions
void p(int case_number, int x, int y, int* dy, int* dx) {
    switch (case_number) {
        case 0:
            if (x <= 2 || y < 4) {
                *dy = L(12);
                *dx = 0;
            } else if (x < 15) {
                *dy = L(12);
                *dx = -(x % 2);
            } else {
                *dy = L(12);
                *dx = L(12) / 2;
            }
            break;
        case 3:
            *dy = L(12) * 1.5;
            *dx = L(13);
            break;
        case 4:
            *dy = L(12) / 2;
            *dx = L(12) / 2;
            break;
        default:
            *dy = L(13) * 1.5 * (1 - (case_number - 1) * 2);
            *dx = L(13) / 2;
            break;
    }
}

// Function to execute a sequence of actions
void t(int row, int col, int x, int y) {
    int A, B, C, D = 5;
    while (y-- > 0) {
        C = 35 - y;
        p(x, y, C, &A, &B);
        if (B > 0 && col > d - 2) B--;
        if ((y < 3) || (x < 3 && y < 10)) {
            t(row, col, 4, y);
        } else if (x == 0 && y % 3 == 0) {
            if (D <= 0) {
                D = 3;
                t(row, col, (E++ % 2) + 1, y + 5);
            }
        }
        D--;
        row += A;
        col += B;
        if (row < 0) row = 0;
        if (col < 0) col = 0;
        l(col, row);
        q(x);
        S(x);
        j();
        o();
    }
}

// Main function
int main() {
    g();
    u();
    k();
    n();
    t(c + 10, d - 1, 0, 35);
    l(b, 0);
}

// External double array
double O[] = {
    2.5673396845218159e-289,
    2.5673475286552589e-289,
    5.0789948392480145e-321,
    4.4759385888332619e-091,
    2.2662500784516041e-085,
    6.0135556610268572e-154,
    6.0138114327429894e-154,
    6.0134700169990685e-154,
    6.0134703504179883e-154,
    2.5663272049433059e+151,
    2.5673651826636406e+151,
    6.0134700183229171e-154,
    5.3767695968532491e-299,
    7.2911289729117876e-304,
    6.1257806499948415e-062,
    4.6555645993480313e+025,
    6.5632629331317560e+299,
    7.9070799242303223e-101,
    3.2391739187041928e-317
};