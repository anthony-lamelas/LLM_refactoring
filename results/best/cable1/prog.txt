```c
#include <stdio.h>
#include <stdlib.h>
#include <math.h>
#include <string.h>
#include <sys/mman.h>

#define TYPEDEF(_) typedef _##t
#define PRINTF(...) _##printf(__VA_ARGS__)
#define LOOP_INDEX(i, n) for (I i = 0; i < (n); i++)
#define PARALLEL_LOOP(h, n) _Pragma("omp parallel for") for (I h = 0; h < (n); h++)

TYPEDEF(int8_) C;
TYPEDEF(in) I;
TYPEDEF(floa) F;
TYPEDEF(struc) { C* c; F* f; } t;

enum { Z = 32, W = 64, E = 2 * W, D = Z * E, H = 86 * E, V = '}\0' };

C* P[V], X[H], Y[D], y[H];
TYPEDEF(F_)[V];
I* _ = U" 炾ોİ䃃璱ᝓ၎瓓甧染ɐఛ瓁", U, s, p, f, R, z, $, B[D], open();
F *A, *G[2], *T, w, b, c;
TYPEDEF() Q[D];
t r, L, J, O[Z], l, a, K, v, k;
Q m, e[4], d[3], n;

I j(I e, F* o, I p, F* v, t* X) {
    w = 1e-5;
    LOOP_INDEX(i, (e ^ V ? D : 0)) {
        w += r[i] * r[i] / D;
    }
    LOOP_INDEX(i, e) {
        o[i] = r[i] / sqrt(w) * i[A + e * D];
    }
    LOOP_INDEX(k, $) {
        LOOP_INDEX(i, W) {
            l[k] = w = fmax(fabs(o[i]) / ~-E, i ? w : 0);
            y[i + k * W] = *o++ / w;
        }
    }
    PARALLEL_LOOP(h, p) {
        LOOP_INDEX(i, $) {
            I _ = 0, t = h * $ + i;
            LOOP_INDEX(k, W) {
                _ += X->c[t * W + k] * y[i * W + k];
            }
            v[h] = _ * X->f[t] * l[i] + !!i * v[h];
        }
    }
    LOOP_INDEX(i, D - c) {
        i[r] += v[i];
    }
    return 0;
}

I main() {
    A = mmap(0, 8e9, 1, 2, f = open(M, f), 0);
    LOOP_INDEX(i, 2) {
        ~f ? i[G] = malloc(3e9) : exit(puts(M " not found"));
    }
    LOOP_INDEX(i, V) {
        i[P] = (C*)A + 4;
        A += (I)*A;
    }
    // Populate structures m, n, e, and d
    g(&m, V);
    g(&n, V);
    g(e, D);
    g(d, H);

    for (C* o;; s >= D ? $ = s = 0 : p < U || PRINTF("%s", $[P])) {
        if (!(*_ ? $ = *++_ : 0)) {
            if ($ < 3 && p >= U) {
                PRINTF("\n\n> ");
                if (0 < scanf("%[^\n]%*c", Y)) {
                    U = *B = 1;
                } else {
                    exit(0);
                }
                p = _(s)(o = X, "[INST] %s%s [/INST]", s ? "" : "<<SYS>>\n"S"\n<</SYS>>\n\n", Y);
                z = p -= z;
                U++[o += z, B] = f;
                for (f = 0; !f; z -= !f) {
                    for (f = V; --f && f[P][z] | memcmp(f[P], o, z);) {}
                }
                p < U ? $ = B[p++] : fflush(0);
            }
            LOOP_INDEX(i, D) {
                R = $ * D + i;
                r[i] = m->c[R] * m->f[R / W];
                R = s++;
                LOOP_INDEX(k, Z) {
                    f = k * D * D;
                    $ = W;
                    LOOP_INDEX(i, 3) {
                        j(k, L, D, i ? G[~-i] + f + R * D : v, e[i] + k);
                    }
                    LOOP_INDEX(i, 2) {
                        LOOP_INDEX(i, D) {
                            b = sin(w = R / exp(i % E / 14.0));
                            c = 1[w = cos(w), T = i++ + (k ? v : *G + f + R * D)];
                            T[1] = b * *T + c * w;
                            *T = w * *T - c * b;
                        }
                        PARALLEL_LOOP(h, Z) {
                            F* T = O[h];
                            w = 0;
                            I A = h * E;
                            LOOP_INDEX(s, E) {
                                LOOP_INDEX(i, E) {
                                    k[L + A] = 0;
                                    T += k[v + A] * k[i * D + *G + A + f] / 11;
                                    w += T[i] = exp(T[i]);
                                }
                            }
                            LOOP_INDEX(s, E) {
                                LOOP_INDEX(i, E) {
                                    k[L + A] += (T[i] /= k ? 1 : w) * k[i * D + G[1] + A + f];
                                }
                            }
                        }
                        j(V, L, D, J, e[3] + k);
                        LOOP_INDEX(i, 2) {
                            j(k + Z, L, H, i ? K : a, d[i] + k);
                        }
                        LOOP_INDEX(i, H) {
                            a[i] *= K[i] / (exp(-a[i]) + 1);
                        }
                        j(V, a, D, L, d[$ = H / $, 2] + k);
                    }
                    w = j($ = W, r, V, k, n);
                    LOOP_INDEX(i, V) {
                        w = k[i] > w ? k[$ = i] : w;
                    }
                }
            }
        }
    }
}
```